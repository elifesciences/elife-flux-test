---
apiVersion: helm.fluxcd.io/v1
kind: HelmRelease
metadata:
  name: libero-editor
  namespace: stg
  annotations:
    fluxcd.io/automated: 'true'
    filter.fluxcd.io/client: glob:master-*-*
    filter.fluxcd.io/articleStore: glob:master-*-*

spec:
  releaseName: libero-editor--stg
  chart:
    git: https://github.com/elifesciences/libero-editor-formula
    path: helm/libero-editor
    ref: master

  values:
    replicaCount: 1
    ingress:
      host: libero-editor--staging--test-cluster.elifesciences.org
      articleStore:
        path: /api/v1(/|$)(.*)
        annotations:
          nginx.ingress.kubernetes.io/rewrite-target: /$2
          nginx.ingress.kubernetes.io/use-regex: "true"

    client:
      image:
        repository: liberoadmin/editor-client
        tag: master-426c99fb-20210118.1004

    articleStore:
      image:
        repository: liberoadmin/editor-article-store
        tag: master-3eb98860-20210118.0957
