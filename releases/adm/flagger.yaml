---
apiVersion: helm.fluxcd.io/v1
kind: HelmRelease
metadata:
  name: flagger
  namespace: adm

spec:
  chart:
    repository: https://flagger.app
    name: flagger
    version: 1.0.0

  values:
    prometheus:
      install: true
    meshProvider: nginx

---
apiVersion: helm.fluxcd.io/v1
kind: HelmRelease
metadata:
  name: flagger-loadtester
  namespace: adm

spec:
  chart:
    repository: https://flagger.app
    name: loadtester
    version: 0.17.0

  values:
    rbac:
      create: true
      scope: cluster
      rules:
        - apiGroups: [""]
          resources: ["secrets"]
          verbs: ["get", "watch", "list", "update"]
        # choose the permission based on helm test type (Pod or Job)
        - apiGroups: [""]
          resources: ["pods", "pods/log"]
          verbs: ["create", "list", "delete", "watch"]
        - apiGroups: ["batch"]
          resources: ["jobs", "jobs/log"]
          verbs: ["create", "list", "delete", "watch"]
