---
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: hello-world-database
spec:
  interval: 1m
  releaseName: hello-world-database
  chart:
    spec:
      chart: pg-db
      version: 2.3.18
      sourceRef:
        kind: HelmRepository
        name: percona
        namespace: db-operator-system
      interval: 1m
  values:
    postgresVersion: 14
    instances:
    - name: instance1
      replicas: 3
      dataVolumeClaimSpec:
        storageClassName: ebs-gp3
        accessModes:
        - ReadWriteOnce
        resources:
          requests:
            storage: 5Gi
    backups:
      pgbackrest:
        repos:
        - name: repo1
          s3:
            bucket: elife-flux-test-hello-world
            region: ${aws_region}
            endpoint: s3.${aws_region}.amazonaws.com
          schedules:
            full: "0 0 * * 6"
            differential: "0 1 * * 1-6"
