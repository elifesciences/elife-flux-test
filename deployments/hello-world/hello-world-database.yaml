---
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: hello-world-database
spec:
  interval: 1m
  releaseName: hello-world-database
  chart:
    spec:
      chart: pg-db
      version: 2.3.18
      sourceRef:
        kind: HelmRepository
        name: percona
        namespace: db-operator-system
      interval: 1m
  values:
    postgresVersion: 14
    instances:
    - name: instance1
      replicas: 3
      dataVolumeClaimSpec:
        storageClassName: ebs-gp3
        accessModes:
        - ReadWriteOnce
        resources:
          requests:
            storage: 5Gi
    backups:
      pgbackrest:
        global:
          repo1-path: /hello-world/hello-world/
          repo1-retention-full: '14'
          repo1-retention-full-type: time
          repo1-s3-key-type: web-id
        metadata:
          annotations:
            eks.amazonaws.com/role-arn: "${aws_backup_service_account_role_arn}"
        repos:
        - name: repo1
          s3:
            bucket: ${aws_backup_s3_bucket}
            region: ${aws_region}
            endpoint: s3.${aws_region}.amazonaws.com
          schedules:
            full: "0 0 * * 6"
            differential: "0 1 * * 1-6"
